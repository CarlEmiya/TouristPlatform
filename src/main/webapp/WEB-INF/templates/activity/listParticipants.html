<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <!-- 引入Bootstrap样式 -->
    <script src="/static/js/jquery-3.4.1.min.js"></script>
    <link rel="stylesheet" href="/static/css/bootstrap.min.css" />
    <script src="/static/js/popper.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script>
        // 踢出用户的方法
        function kickOutUser(userId, aid) {
            console.log("kick out user " + userId + " from activity " + aid);
            fetch('/travelActivity/kickOutUser', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: `userId=${userId}&aid=${aid}`
            })
                .then(response => response.json())
                .then(data => {
                    showFeedbackMessage(data.message, data.status);
                    // 重新加载
                    window.location.reload();
                })
                .catch(error => {
                    showFeedbackMessage("请求失败，请稍后再试！", "error");
                });
        }

        // 展示反馈信息
        function showFeedbackMessage(message, status) {
            var feedbackElement = document.getElementById("feedbackMessage");
            feedbackElement.innerText = message;

            if (status == "success") {
                feedbackElement.style.color = "green";
            } else {
                feedbackElement.style.color = "red";
            }

            // 显示模态框
            document.getElementById('feedbackModal').style.display = 'block';

            // 2秒后自动关闭模态框
            setTimeout(function() {
                document.getElementById('feedbackModal').style.display = 'none';
            }, 1800);
        }
    </script>
</head>
<body>
<div class="container">
<!--    如果registrations和userMap不为空-->
    <div th:if="${!#lists.isEmpty(registrations)}">
        <table class="table" id="participantTable" th:if="${!#lists.isEmpty(userMap)}">
            <thead>
            <tr>
                <th>用户ID</th>
                <th>用户姓名</th>
                <th>操作</th>
            </tr>
            </thead>
            <tbody>
            <!-- 检查是否有报名记录 -->
            <div th:if="${#lists.isEmpty(registrations)}">
                <tr>
                    <td colspan="3">暂无参与人员</td>
                </tr>
            </div>
            <!-- 遍历所有报名记录，并显示每个用户的信息 -->
            <tr th:each="registration : ${registrations}">
                <td th:text="${registration.uid}"></td>
                <!-- 通过 userMap 获取用户信息 -->
                <td th:text="${userMap[registration.uid].name}"></td>
                <td>
                    <button type="button" class="btn btn-danger"
                            th:attr="onclick='kickOutUser(' + ${registration.uid} + ', ' + ${aid} + ')'" >
                        踢出
                    </button>
                </td>
            </tr>
            </tbody>
        </table>
    </div>


    <!-- 如果registrations为空 -->
    <div th:if="${#lists.isEmpty(registrations)}">
        <p>暂无参与者</p>
        <a th:href="@{/travelActivity/detail(aid=${aid})}" class="btn btn-primary">返回</a>
    </div>

    <!-- 如果userMap为空 -->
    <div th:if="${#lists.isEmpty(userMap)}">
        <p>无法获取用户信息</p>
        <a th:href="@{/travelActivity/detail(aid=${aid})}" class="btn btn-primary">返回</a>
    </div>
</div><!-- 参与人员列表 -->


<!-- 反馈消息模态框 -->
<div id="feedbackModal" class="modal" tabindex="-1" role="dialog" style="display:none;">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">反馈消息</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p id="feedbackMessage">这里是反馈信息</p>
            </div>
        </div>
    </div>
</div>

</body>
</html>
