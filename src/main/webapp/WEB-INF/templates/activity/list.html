<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>活动列表</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="/static/css/activity/list.css">
    <link rel="stylesheet" href="/static//css/bootstrap.min.css">
    <script src="/static/js/jquery-3.4.1.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script>
        function clearFilters() {
            window.location.href = '/travelActivity/list'; // 刷新页面，去掉所有筛选条件
        }
    </script>
</head>
<body>
<div class="container">
    <h1>所有活动</h1>

    <!-- 筛选表单 -->
    <form th:action="@{/travelActivity/list}" method="get">
        <div class="form-group">
            <label for="keyword">关键字</label>
            <input type="text" id="keyword" name="keyword" class="form-control" th:value="${keyword}">
        </div>

        <div class="form-group">
            <label for="status">活动状态</label>
            <select id="status" name="status" class="form-control">
                <option value="" th:selected="${status == null}">全部</option>
                <option value="1" th:selected="${status == 1}">未开始</option>
                <option value="4" th:selected="${status == 4}">组团中</option>
                <option value="5" th:selected="${status == 5}">已成团</option>
                <option value="6" th:selected="${status == 6}">活动进行中</option>
                <option value="7" th:selected="${status == 7}">已取消</option>
                <option value="16" th:selected="${status == 16}">已结束</option>
            </select>
        </div>

        <div class="form-group">
            <label for="timeInterval">时间筛选</label>
            <select id="timeInterval" name="timeInterval" class="form-control">
                <option value="" th:selected="${timeInterval == null}">全部</option>
                <option value="1" th:selected="${timeInterval == 1}">最近一个月</option>
                <option value="3" th:selected="${timeInterval == 3}">最近三个月</option>
                <option value="6" th:selected="${timeInterval == 6}">最近半年</option>
                <option value="12" th:selected="${timeInterval == 12}">最近一年</option>
            </select>
        </div>

        <button type="submit" class="btn btn-primary">筛选</button>
        <!-- 取消筛选按钮，如果有筛选条件时显示 -->
        <button type="button" class="btn btn-secondary" th:if="${keyword != null or status != null or timeInterval != null}"
                onclick="clearFilters()">取消筛选</button>


    </form>
    <!--        //点击取消筛选按钮，console输出当前筛选条件-->
    <hr />

    <!-- 活动列表 -->
    <div class="activity-list-container">
        <ul class="list-group" th:if="${not #lists.isEmpty(activities)}">
            <li th:each="activity : ${activities}" class="list-group-item">
                <!-- 整个li作为超链接 -->
                <a th:href="@{/travelActivity/detail/{aid}(aid=${activity.aid})}" class="d-flex align-items-center">

                    <!-- 左侧显示活动图片 -->
                    <img th:src="${activity.firstFilePath != null ? activity.firstFilePath : '/static/img/activity/default.gif'}"
                         class="activity-image" alt="活动图片"
                         style="width: 100px; height: 100px; object-fit: cover; margin-right: 15px;">



                    <!-- 右侧显示标题、描述、状态 -->
                    <div class="activity-info">
                        <h5 th:text="${activity.title}"></h5>
                        <p th:text="${activity.description}"></p>
                        <p th:text="'状态: ' + ${activity.status == 1 ? '进行中' : (activity.status == 16 ? '已结束' : '已取消')}"></p>
                    </div>
                </a>
            </li>
        </ul>


        <!-- 如果没有活动，则显示图片 -->
        <div th:if="${#lists.isEmpty(activities)}" class="no-activities">
            <img src="/static/img/activity/noActivity.png" alt="No activities available">
        </div>

        <!-- 发布活动按钮 -->
        <div th:if="${session.currentUser.level >= 3}">
            <a href="/travelActivity/publish" class="btn btn-primary">发布活动</a>
        </div>
    </div>

    <div th:if="${not #lists.isEmpty(activities)}">
        <div class="pagination-container">
            <ul class="pagination">
                <!-- 首页 -->
                <li th:class="${pageInfo.pageNum == 1} ? 'disabled' : ''">
                    <a href="#" th:href="@{/travelActivity/list(pageNo=1, pageSize=${pageInfo.pageSize}, keyword=${keyword}, status=${status}, timeInterval=${timeInterval})}">首页</a>
                </li>

                <!-- 上一页 -->
                <li th:class="${pageInfo.pageNum == 1} ? 'disabled' : ''">
                    <a href="#" th:href="@{/travelActivity/list(pageNo=${pageInfo.pageNum - 1}, pageSize=${pageInfo.pageSize}, keyword=${keyword}, status=${status}, timeInterval=${timeInterval})}">&laquo;</a>
                </li>

                <!-- 页码范围 -->
                <li th:each="i : ${#numbers.sequence(pageInfo.pageNum - 2, pageInfo.pageNum + 2)}"
                    th:if="${i > 0 and i <= pageInfo.pages}">
                    <a href="#" th:href="@{/travelActivity/list(pageNo=${i}, pageSize=${pageInfo.pageSize}, keyword=${keyword}, status=${status}, timeInterval=${timeInterval})}"
                       th:text="${i}"
                       th:class="${i == pageInfo.pageNum} ? 'active' : ''"></a>
                </li>

                <!-- 下一页 -->
                <li th:class="${pageInfo.pageNum == pageInfo.pages} ? 'disabled' : ''">
                    <a href="#" th:href="@{/travelActivity/list(pageNo=${pageInfo.pageNum + 1}, pageSize=${pageInfo.pageSize}, keyword=${keyword}, status=${status}, timeInterval=${timeInterval})}">&raquo;</a>
                </li>

                <!-- 尾页 -->
                <li th:class="${pageInfo.pageNum == pageInfo.pages} ? 'disabled' : ''">
                    <a href="#" th:href="@{/travelActivity/list(pageNo=${pageInfo.pages}, pageSize=${pageInfo.pageSize}, keyword=${keyword}, status=${status}, timeInterval=${timeInterval})}">尾页</a>
                </li>
            </ul>
        </div>
    </div>
</div>
</body>

</html>
